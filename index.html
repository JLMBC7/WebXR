<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dumpster Fire AR</title>
    <!-- Include A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        .ui-overlay {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: sans-serif;
            text-align: center;
            pointer-events: none;
            width: 80%;
            max-width: 300px;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    
    <div class="ui-overlay">
        Point camera at a <b>Hiro Marker</b><br>
        <small>Replacing placeholder with GLB loader...</small>
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;" 
        renderer="antialias: true; alpha: true; colorManagement: true;">
        
        <!-- Assets Management -->
        <a-assets>
            <!-- 
                REPLACE THE SRC BELOW WITH YOUR .GLB PATH 
                Example: "models/my-dumpster.glb"
            -->
            <a-asset-item id="dumpster-model" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Box/glTF-Binary/Box.glb"></a-asset-item>
        </a-assets>

        <!-- AR Marker Handler -->
        <a-marker type="pattern" url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro">
            
            <!-- THE GLB DUMPSTER MODEL -->
            <a-entity 
                id="dumpster-container" 
                position="0 0 0" 
                scale="1 1 1">
                
                <!-- 
                    GLB Component: Adjust scale/rotation to match your specific model 
                    Note: Using crossOrigin for external assets 
                -->
                <a-entity 
                    gltf-model="#dumpster-model" 
                    position="0 0 0"
                    rotation="0 0 0"
                    scale="0.5 0.5 0.5">
                </a-entity>
                
                <!-- THE FIRE SYSTEM (Positioned inside the model) -->
                <a-entity id="fire-container" position="0 0.2 0" fire-system></a-entity>
                
                <!-- Dynamic Fire Glow -->
                <a-light type="point" color="#ff6600" intensity="2" distance="2"
                         animation="property: intensity; from: 1; to: 2.5; dir: alternate; dur: 120; loop: true">
                </a-light>
            </a-entity>

        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Enhanced Fire System for GLB integration
        AFRAME.registerComponent('fire-system', {
            init: function () {
                this.particles = [];
                this.particleCount = 35;
                
                for (let i = 0; i < this.particleCount; i++) {
                    this.createParticle();
                }
            },

            createParticle: function () {
                const p = document.createElement('a-entity');
                
                const size = Math.random() * 0.25 + 0.15;
                p.setAttribute('geometry', {
                    primitive: 'plane',
                    width: size,
                    height: size
                });

                const colors = ['#ffcc00', '#ff8800', '#ff3300', '#ff5500'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                p.setAttribute('material', {
                    color: color,
                    transparent: true,
                    opacity: 0.8,
                    shader: 'flat',
                    side: 'double',
                    blending: 'additive' // Better fire look
                });

                // Tighter spread to fit inside a model
                const x = (Math.random() - 0.5) * 0.4;
                const z = (Math.random() - 0.5) * 0.4;
                p.setAttribute('position', { x: x, y: 0, z: z });
                
                this.particles.push({
                    el: p,
                    speed: Math.random() * 0.015 + 0.005,
                    life: Math.random(),
                    drift: (Math.random() - 0.5) * 0.005
                });

                this.el.appendChild(p);
            },

            tick: function (time, timeDelta) {
                this.particles.forEach(p => {
                    let pos = p.el.getAttribute('position');
                    
                    pos.y += p.speed;
                    pos.x += p.drift;
                    
                    p.life -= 0.02;
                    p.el.setAttribute('material', 'opacity', p.life);
                    
                    if (p.life <= 0 || pos.y > 0.8) {
                        pos.y = 0;
                        pos.x = (Math.random() - 0.5) * 0.4;
                        pos.z = (Math.random() - 0.5) * 0.4;
                        p.life = 1.0;
                    }
                    
                    p.el.setAttribute('position', pos);
                    
                    // Simple Billboarding: Face the camera (located at 0,0,0 in marker space)
                    p.el.object3D.lookAt(0, pos.y, 0);
                });
            }
        });
    </script>
</body>
</html>