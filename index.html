<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Dumpster Fire AR</title>
    <!-- Include A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        .ui-overlay {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: sans-serif;
            text-align: center;
            pointer-events: none;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    
    <div class="ui-overlay">
        Point camera at a <b>Hiro Marker</b><br>
        <small>The fire is simulated with a custom particle system</small>
    </div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false;" 
        renderer="antialias: true; alpha: true;">
        
        <!-- Assets -->
        <a-assets>
            <!-- Mocking the dumpster with primitives since we can't load local files -->
            <a-asset-item id="myModel" src="your_model.glb"></a-asset-item>
        </a-assets>

        <!-- AR Marker Handler -->
        <a-marker type="pattern" url="https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/data/patt.hiro">
            
            <!-- THE DUMPSTER (Placeholder Geometry) -->
            <a-entity id="dumpster" position="0 0.6 0">
                <!-- Main Body -->
                <a-entity gltf-model="#myModel"></a-entity>
                <!-- Floor -->
                <a-entity geometry="primitive: box; width: 2; height: 0.1; depth: 1.4" material="color: #1a252f" position="0 -0.6 0"></a-entity>
                
                <!-- THE FIRE SYSTEM -->
                <!-- We use a custom component to handle particles inside the dumpster -->
                <a-entity id="fire-container" position="0 -0.3 0" fire-system></a-entity>
                
                <!-- Flicker Light -->
                <a-light type="point" color="#ff6600" intensity="2" distance="3"
                         animation="property: intensity; from: 1.5; to: 2.5; dir: alternate; dur: 100; loop: true">
                </a-light>
            </a-entity>

        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Custom A-Frame component for the fire particles
        AFRAME.registerComponent('fire-system', {
            init: function () {
                this.particles = [];
                this.particleCount = 40;
                
                for (let i = 0; i < this.particleCount; i++) {
                    this.createParticle();
                }
            },

            createParticle: function () {
                const p = document.createElement('a-entity');
                
                // Randomize flame start properties
                const size = Math.random() * 0.4 + 0.2;
                p.setAttribute('geometry', {
                    primitive: 'plane',
                    width: size,
                    height: size
                });

                // Fire colors: Yellow to Red
                const colors = ['#ffcc00', '#ff6600', '#ff3300', '#e67e22'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                p.setAttribute('material', {
                    color: color,
                    transparent: true,
                    opacity: 0.8,
                    shader: 'flat',
                    side: 'double'
                });

                // Initial position (randomized inside the dumpster)
                const x = (Math.random() - 0.5) * 1.5;
                const z = (Math.random() - 0.5) * 1.0;
                p.setAttribute('position', { x: x, y: 0, z: z });
                
                // Save custom data for animation logic
                this.particles.push({
                    el: p,
                    speed: Math.random() * 0.02 + 0.01,
                    life: Math.random(),
                    drift: (Math.random() - 0.5) * 0.01
                });

                this.el.appendChild(p);
            },

            tick: function (time, timeDelta) {
                this.particles.forEach(p => {
                    let pos = p.el.getAttribute('position');
                    
                    // Move up
                    pos.y += p.speed;
                    pos.x += p.drift;
                    
                    // Fade out
                    p.life -= 0.015;
                    p.el.setAttribute('material', 'opacity', p.life);
                    
                    // Reset particle when "dead" or too high
                    if (p.life <= 0 || pos.y > 1.5) {
                        pos.y = 0;
                        pos.x = (Math.random() - 0.5) * 1.5;
                        pos.z = (Math.random() - 0.5) * 1.0;
                        p.life = 1.0;
                    }
                    
                    // Billboard effect (always face camera)
                    // In AR.js, the camera is at (0,0,0) essentially, but A-Frame handles the world space.
                    // For simplicity, we just keep them slightly rotated or use a shader. 
                    // Here we'll just let them be 3D planes for that "paper fire" look.
                    p.el.setAttribute('position', pos);
                });
            }
        });
    </script>
</body>
</html>